{% include 'admin/components/header.html' %}

<body id="page-top">

    <!-- Page Wrapper -->
    <div id="wrapper">

        <!-- Sidebar -->
        {% include 'researcher/components/sidebar.html' %}
        <!-- End of Sidebar -->

        <!-- Content Wrapper -->
        <div id="content-wrapper" class="d-flex flex-column">

            <!-- Main Content -->
            <div id="content">

                <!-- Topbar -->
                {% include 'admin/components/topbar.html' %}
                <!-- End of Topbar -->

                <!-- Begin Page Content -->
                <div class="container-fluid">

                    <!-- Page Heading -->
                    <div class="d-sm-flex align-items-center justify-content-between mb-4">
                        <h1 class="h3 mb-0 text-gray-800">{{ thesis.title }}</h1>
                        <div>
                            {% if thesis.frozen %}
                                <button class="btn btn-warning" onclick="unfreezeThesis({{ thesis.id }})">
                                    <i class="fas fa-unlock"></i> Unfreeze
                                </button>
                            {% else %}
                                <button class="btn btn-outline-warning" onclick="freezeThesis({{ thesis.id }})">
                                    <i class="fas fa-lock"></i> Freeze
                                </button>
                            {% endif %}
                            <a href="{{ url_for('researcher.supervisor_theses') }}" class="btn btn-secondary">
                                <i class="fas fa-arrow-left"></i> Back to Theses
                            </a>
                        </div>
                    </div>

                    <!-- Flash Messages -->
                    {% with messages = get_flashed_messages() %}
                        {% if messages %}
                            {% for message in messages %}
                                <div class="alert alert-info alert-dismissible fade show" role="alert">
                                    {{ message }}
                                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                            {% endfor %}
                        {% endif %}
                    {% endwith %}

                    <!-- Thesis Info Row -->
                    <div class="row">
                        <div class="col-xl-8 col-lg-7">
                            <div class="card shadow mb-4">
                                <div class="card-header py-3 d-flex justify-content-between align-items-center">
                                    <h6 class="m-0 font-weight-bold text-primary">Thesis Information</h6>
                                    <button class="btn btn-primary btn-sm" data-toggle="modal" data-target="#editThesisModal">
                                        <i class="fas fa-edit"></i> Edit Thesis
                                    </button>
                                </div>
                                <div class="card-body">
                                    <p class="text-gray-700">{{ thesis.description }}</p>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <strong>Level:</strong> {{ thesis.level|title if thesis.level else 'Not specified' }}
                                        </div>
                                        <div class="col-md-6">
                                            <strong>Created:</strong> {{ dt(thesis.created_at).strftime('%B %d, %Y') if thesis.created_at else 'Unknown' }}
                                        </div>
                                    </div>
                                    {% if student %}
                                    <div class="mt-3">
                                        <strong>Student:</strong> {{ student.name }} {{ student.surname }}
                                        <br><small class="text-muted">{{ student.email }}</small>
                                        <div class="mt-2">
                                            <form method="POST" action="{{ url_for('researcher.unassign_thesis', thesis_id=thesis.id) }}" style="display: inline;">
                                                <button type="submit" class="btn btn-warning btn-sm" 
                                                        onclick="return confirm('Are you sure you want to unassign this student from the thesis?')">
                                                    <i class="fas fa-user-times"></i> Unassign Student
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                    {% else %}
                                    <div class="mt-3">
                                        <span class="badge badge-warning">No student assigned</span>
                                        {% if available_students %}
                                        <div class="mt-3">
                                            <strong>Assign Student:</strong>
                                            <form method="POST" action="{{ url_for('researcher.assign_thesis') }}" class="mt-2">
                                                <input type="hidden" name="thesis_id" value="{{ thesis.id }}">
                                                <div class="form-row">
                                                    <div class="col-md-8">
                                                        <select name="student_id" class="form-control form-control-sm" required>
                                                            <option value="">Select a student...</option>
                                                            {% for student in available_students %}
                                                            <option value="{{ student.id }}">{{ student.name }} {{ student.surname }} ({{ student.email }})</option>
                                                            {% endfor %}
                                                        </select>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <button type="submit" class="btn btn-success btn-sm">
                                                            <i class="fas fa-user-plus"></i> Assign
                                                        </button>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                        {% else %}
                                        <div class="mt-2">
                                            <small class="text-muted">No available students (all students have active thesis assignments)</small>
                                        </div>
                                        {% endif %}
                                    </div>
                                    {% endif %}
                                    
                                    {% if thesis_tags %}
                                    <div class="mt-3">
                                        <strong>Tags:</strong>
                                        {% for tag in thesis_tags %}
                                            <span class="badge badge-secondary mr-1">{{ tag.tag }}</span>
                                        {% endfor %}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Quick Stats -->
                        <div class="col-xl-4 col-lg-5">
                            <div class="card shadow mb-4">
                                <div class="card-header py-3">
                                    <h6 class="m-0 font-weight-bold text-primary">Statistics</h6>
                                </div>
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center mb-3">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                                Total Updates</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ updates|length }}</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-edit fa-2x text-gray-300"></i>
                                        </div>
                                    </div>

                                    <div class="row no-gutters align-items-center mb-3">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                                Student Updates</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800">
                                                {{ updates|selectattr('update_type', 'equalto', 'student_update')|list|length }}
                                            </div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-user fa-2x text-gray-300"></i>
                                        </div>
                                    </div>

                                    <div class="row no-gutters align-items-center mb-3">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                                Resources</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ resources|length }}</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-link fa-2x text-gray-300"></i>
                                        </div>
                                    </div>

                                    <div class="row no-gutters align-items-center mb-3">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                                To-Do Items</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ todos|length }}</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-tasks fa-2x text-gray-300"></i>
                                        </div>
                                    </div>

                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-dark text-uppercase mb-1">
                                                Meeting Notes</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ meeting_notes|length }}</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-clipboard fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Recent To-Do Items -->
                            <div class="card shadow mb-4">
                                <div class="card-header py-3">
                                    <h6 class="m-0 font-weight-bold text-primary">Recent To-Do Items</h6>
                                </div>
                                <div class="card-body">
                                    {% if todos %}
                                        {% for todo in todos[:5] %}
                                        <div class="d-flex align-items-center mb-2">
                                            <div class="mr-3">
                                                {% if todo.status == 'completed' %}
                                                    <i class="fas fa-check-circle text-success"></i>
                                                {% else %}
                                                    <i class="fas fa-circle text-warning"></i>
                                                {% endif %}
                                            </div>
                                            <div class="flex-grow-1">
                                                <h6 class="mb-0">
                                                    <a href="{{ url_for('researcher.supervisor_todo_detail', todo_id=todo.id) }}" 
                                                       class="text-decoration-none">
                                                        {{ todo.title }}
                                                    </a>
                                                </h6>
                                                <small class="text-muted">{{ todo.priority|title }}</small>
                                            </div>
                                        </div>
                                        {% endfor %}
                                        {% if todos|length > 5 %}
                                        <small class="text-muted">And {{ todos|length - 5 }} more...</small>
                                        {% endif %}
                                    {% else %}
                                        <p class="text-muted text-center">No to-do items yet.</p>
                                    {% endif %}
                                </div>
                            </div>

                            <!-- Resources -->
                            <div class="card shadow mb-4">
                                <div class="card-header py-3">
                                    <h6 class="m-0 font-weight-bold text-primary">Resources</h6>
                                </div>
                                <div class="card-body">
                                    {% if resources %}
                                        {% for resource in resources[:5] %}
                                        <div class="mb-2">
                                            <a href="{{ resource.resource_url }}" target="_blank" class="text-decoration-none">
                                                <i class="fas fa-external-link-alt"></i> {{ resource.description or resource.resource_url }}
                                            </a>
                                            <br><small class="text-muted">{{ resource.resource_type|title }}</small>
                                        </div>
                                        {% endfor %}
                                        {% if resources|length > 5 %}
                                        <small class="text-muted">And {{ resources|length - 5 }} more resources...</small>
                                        {% endif %}
                                    {% else %}
                                        <p class="text-muted text-center">No resources yet.</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Updates -->
                    <div class="row">
                        <div class="col-12">
                            <div class="card shadow mb-4">
                                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                    <h6 class="m-0 font-weight-bold text-primary">Student Updates</h6>
                                    <button class="btn btn-info btn-sm" data-toggle="modal" data-target="#addFeedbackModal">
                                        <i class="fas fa-plus"></i> Add Feedback
                                    </button>
                                </div>
                                <div class="card-body">
                                    {% if updates %}
                                        {% for update in updates %}
                                        <div class="border-left-primary shadow-sm p-3 mb-3">
                                            <div class="d-flex justify-content-between">
                                                <h6 class="font-weight-bold">
                                                    {{ update.title }}
                                                    <span class="badge badge-info ml-2">{{ update.update_type|replace('_', ' ')|title }}</span>
                                                    {% if update.tags %}
                                                        {% for tag in update.tags %}
                                                            <span class="badge badge-secondary ml-1">{{ tag.tag }}</span>
                                                        {% endfor %}
                                                    {% endif %}
                                                </h6>
                                                <div class="dropdown">
                                                    <button class="btn btn-link btn-sm" type="button" data-toggle="dropdown">
                                                        <i class="fas fa-ellipsis-v"></i>
                                                    </button>
                                                    <div class="dropdown-menu">
                                                        <a class="dropdown-item" href="#" onclick="editUpdate({{ update.id }}, '{{ update.title }}', '{{ update.description }}')">
                                                            <i class="fas fa-edit"></i> Edit Feedback
                                                        </a>
                                                        <a class="dropdown-item" href="#" onclick="commentOnUpdate({{ update.id }})">
                                                            <i class="fas fa-comment"></i> Add Comment
                                                        </a>
                                                        <a class="dropdown-item" href="#" onclick="tagUpdate({{ update.id }})">
                                                            <i class="fas fa-tag"></i> Add Tag
                                                        </a>
                                                    </div>
                                                </div>
                                            </div>
                                            <p class="mb-2">{{ update.content }}</p>
                                            
                                            <!-- Todo References -->
                                            {% if update.todo_references %}
                                            <div class="mt-2 mb-2">
                                                <small class="text-muted">Referenced Todos:</small>
                                                {% for ref in update.todo_references %}
                                                <a href="{{ url_for('researcher.supervisor_todo_detail', todo_id=ref.todo.id) }}"
                                                   class="badge badge-primary ml-1" title="{{ ref.todo.title }}">
                                                    <i class="fas fa-tasks"></i> {{ ref.todo.title[:20] }}{% if ref.todo.title|length > 20 %}...{% endif %}
                                                </a>
                                                {% endfor %}
                                            </div>
                                            {% endif %}
                                            
                                            <small class="text-muted">
                                                {{ dt(update.created_at).strftime('%B %d, %Y at %I:%M %p') }}
                                                {% if update.author %}
                                                    by {{ update.author.name }} {{ update.author.surname }}
                                                {% endif %}
                                            </small>
                                        </div>
                                        {% endfor %}
                                    {% else %}
                                        <p class="text-muted text-center">No updates yet.</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Thesis Status Management Section -->
                    <div class="row">
                        <div class="col-12">
                            <div class="card shadow mb-4">
                                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                    <h6 class="m-0 font-weight-bold text-primary">Thesis Status</h6>
                                    <button class="btn btn-info btn-sm" data-toggle="modal" data-target="#setStatusModal">
                                        <i class="fas fa-edit"></i> Set Status
                                    </button>
                                </div>
                                <div class="card-body">
                                    {% if thesis.status %}
                                        {% set latest_status = thesis.status[-1] %}
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <span class="badge badge-lg 
                                                    {% if latest_status.status == 'approved' %}badge-success
                                                    {% elif latest_status.status == 'needs-revision' %}badge-warning
                                                    {% elif latest_status.status == 'in-progress' %}badge-info
                                                    {% elif latest_status.status == 'suspended' %}badge-danger
                                                    {% else %}badge-secondary{% endif %}">
                                                    {{ latest_status.status|title }}
                                                </span>
                                                <small class="text-muted ml-2">
                                                    Updated: {{ dt(latest_status.updated_at).strftime('%B %d, %Y at %I:%M %p') if latest_status.updated_at else 'Unknown' }}
                                                </small>
                                            </div>
                                        </div>
                                        
                                        <!-- Status History -->
                                        {% if thesis.status|length > 1 %}
                                        <div class="mt-3">
                                            <h6 class="text-muted">Status History:</h6>
                                            {% for status in thesis.status[:-1]|reverse %}
                                            <div class="border-left border-secondary pl-3 mb-2">
                                                <span class="badge badge-secondary">{{ status.status|title }}</span>
                                                <small class="text-muted ml-2">{{ dt(status.updated_at).strftime('%B %d, %Y') if status.updated_at else 'Unknown' }}</small>
                                            </div>
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                    {% else %}
                                        <p class="text-muted">No status set yet. Use the "Set Status" button to assign an advancement status.</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Objectives Section -->
                    <div class="row">
                        <div class="col-12">
                            <div class="card shadow mb-4">
                                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                    <h6 class="m-0 font-weight-bold text-primary">Thesis Objectives</h6>
                                    <button class="btn btn-success btn-sm" data-toggle="modal" data-target="#addObjectiveModal">
                                        <i class="fas fa-plus"></i> Add Objective
                                    </button>
                                </div>
                                <div class="card-body">
                                    {% if objectives %}
                                        {% for objective in objectives %}
                                        <div class="d-flex justify-content-between align-items-start mb-3 p-3 border-left-success">
                                            <div class="flex-grow-1">
                                                <h6 class="mb-1">{{ objective.title }}</h6>
                                                <p class="mb-1">{{ objective.description }}</p>
                                                <small class="text-muted">Added: {{ dt(objective.created_at).strftime('%B %d, %Y') }}</small>
                                            </div>
                                            <div class="dropdown">
                                                <button class="btn btn-link btn-sm" type="button" data-toggle="dropdown">
                                                    <i class="fas fa-ellipsis-v"></i>
                                                </button>
                                                <div class="dropdown-menu">
                                                    <a class="dropdown-item" href="#" onclick="editObjective({{ objective.id }}, '{{ objective.title }}', '{{ objective.description }}')">
                                                        <i class="fas fa-edit"></i> Edit
                                                    </a>
                                                    <a class="dropdown-item text-danger" href="{{ url_for('researcher.delete_objective', objective_id=objective.id) }}" onclick="return confirm('Are you sure?')">
                                                        <i class="fas fa-trash"></i> Delete
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                        {% endfor %}
                                    {% else %}
                                        <p class="text-muted text-center">No objectives defined yet.</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Hypotheses Section -->
                    <div class="row">
                        <div class="col-12">
                            <div class="card shadow mb-4">
                                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                    <h6 class="m-0 font-weight-bold text-primary">Research Hypotheses</h6>
                                    <button class="btn btn-warning btn-sm" data-toggle="modal" data-target="#addHypothesisModal">
                                        <i class="fas fa-plus"></i> Add Hypothesis
                                    </button>
                                </div>
                                <div class="card-body">
                                    {% if hypotheses %}
                                        {% for hypothesis in hypotheses %}
                                        <div class="d-flex justify-content-between align-items-start mb-3 p-3 border-left-warning">
                                            <div class="flex-grow-1">
                                                <h6 class="mb-1">{{ hypothesis.title }}</h6>
                                                <p class="mb-1">{{ hypothesis.description }}</p>
                                                <small class="text-muted">Added: {{ dt(hypothesis.created_at).strftime('%B %d, %Y') }}</small>
                                            </div>
                                            <div class="dropdown">
                                                <button class="btn btn-link btn-sm" type="button" data-toggle="dropdown">
                                                    <i class="fas fa-ellipsis-v"></i>
                                                </button>
                                                <div class="dropdown-menu">
                                                    <a class="dropdown-item" href="#" onclick="editHypothesis({{ hypothesis.id }}, '{{ hypothesis.title }}', '{{ hypothesis.description }}')">
                                                        <i class="fas fa-edit"></i> Edit
                                                    </a>
                                                    <a class="dropdown-item text-danger" href="{{ url_for('researcher.delete_hypothesis', hypothesis_id=hypothesis.id) }}" onclick="return confirm('Are you sure?')">
                                                        <i class="fas fa-trash"></i> Delete
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                        {% endfor %}
                                    {% else %}
                                        <p class="text-muted text-center">No hypotheses defined yet.</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Meeting Notes Section -->
                    <div class="row">
                        <div class="col-12">
                            <div class="card shadow mb-4">
                                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                    <h6 class="m-0 font-weight-bold text-primary">Meeting Notes</h6>
                                    <button class="btn btn-dark btn-sm" data-toggle="modal" data-target="#addMeetingNoteModal">
                                        <i class="fas fa-plus"></i> Add Meeting Note
                                    </button>
                                </div>
                                <div class="card-body">
                                    {% if meeting_notes %}
                                        {% for note in meeting_notes %}
                                        <div class="d-flex justify-content-between align-items-start mb-3 p-3 border-left-dark">
                                            <div class="flex-grow-1">
                                                <h6 class="mb-1">
                                                    <a href="{{ url_for('researcher.supervisor_meeting_note_detail', note_id=note.id) }}" 
                                                       class="text-decoration-none">
                                                        {{ note.title }}
                                                    </a>
                                                </h6>
                                                <p class="mb-1">{{ note.content[:200] }}{% if note.content|length > 200 %}...{% endif %}</p>
                                                
                                                <!-- Todo References -->
                                                {% if note.todo_references %}
                                                <div class="mt-2 mb-2">
                                                    <small class="text-muted">Referenced Todos:</small>
                                                    {% for ref in note.todo_references %}
                                                    <a href="{{ url_for('researcher.supervisor_todo_detail', todo_id=ref.todo.id) }}" 
                                                       class="badge badge-primary ml-1" title="{{ ref.todo.title }}">
                                                        <i class="fas fa-tasks"></i> {{ ref.todo.title[:15] }}{% if ref.todo.title|length > 15 %}...{% endif %}
                                                    </a>
                                                    {% endfor %}
                                                </div>
                                                {% endif %}
                                                
                                                <small class="text-muted">
                                                    {{ dt(note.created_at).strftime('%B %d, %Y') }}
                                                    {% if note.author %}
                                                        by {{ note.author.name }} {{ note.author.surname }}
                                                    {% endif %}
                                                </small>
                                            </div>
                                            <div class="dropdown">
                                                <button class="btn btn-link btn-sm" type="button" data-toggle="dropdown">
                                                    <i class="fas fa-ellipsis-v"></i>
                                                </button>
                                                <div class="dropdown-menu">
                                                    <a class="dropdown-item" href="{{ url_for('researcher.supervisor_meeting_note_detail', note_id=note.id) }}">
                                                        <i class="fas fa-eye"></i> View Details
                                                    </a>
                                                    <a class="dropdown-item" href="#" onclick="editMeetingNote({{ note.id }}, '{{ note.title }}', '{{ note.content|replace('\n', '\\n')|replace('\'', '\\\'') }}')">
                                                        <i class="fas fa-edit"></i> Edit
                                                    </a>
                                                    <a class="dropdown-item text-danger" href="{{ url_for('researcher.delete_meeting_note', note_id=note.id) }}" onclick="return confirm('Are you sure?')">
                                                        <i class="fas fa-trash"></i> Delete
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                        {% endfor %}
                                    {% else %}
                                        <p class="text-muted text-center">No meeting notes yet.</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <!-- /.container-fluid -->

            </div>
            <!-- End of Main Content -->

            <!-- Footer -->
            {% include 'admin/components/footer.html' %}
            <!-- End of Footer -->

        </div>
        <!-- End of Content Wrapper -->

    </div>
    <!-- End of Page Wrapper -->

    <!-- Add Supervisor Feedback Modal -->
    <div class="modal fade" id="addFeedbackModal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Supervisor Feedback</h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form method="POST" action="{{ url_for('researcher.post_update') }}">
                    <input type="hidden" name="thesis_id" value="{{ thesis.id }}">
                    <input type="hidden" name="update_type" value="supervisor_feedback">
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="title">Feedback Title:</label>
                            <input type="text" class="form-control" name="title" required>
                        </div>
                        <div class="form-group">
                            <label for="content">Feedback Content:</label>
                            <textarea class="form-control" name="content" rows="5" required></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Add Feedback</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Feedback Modal -->
    <div class="modal fade" id="editFeedbackModal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Feedback</h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form method="POST" action="{{ url_for('researcher.modify_update') }}">
                    <div class="modal-body">
                        <input type="hidden" name="update_id" id="edit_update_id">
                        <div class="form-group">
                            <label for="new_content">Feedback Content:</label>
                            <textarea class="form-control" name="new_content" id="edit_update_content" rows="5" required></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Comment on Update Modal -->
    <div class="modal fade" id="commentModal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Comment</h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form method="POST" action="{{ url_for('researcher.comment_on_update') }}">
                    <div class="modal-body">
                        <input type="hidden" name="update_id" id="comment_update_id">
                        <div class="form-group">
                            <label for="comment">Your Comment:</label>
                            <textarea class="form-control" name="comment" rows="4" required placeholder="Add your feedback or comment on this update..."></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Add Comment</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Tag Update Modal -->
    <div class="modal fade" id="tagModal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Tag Update</h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form method="POST" action="{{ url_for('researcher.tag_update') }}">
                    <div class="modal-body">
                        <input type="hidden" name="update_id" id="tag_update_id">
                        <div class="form-group">
                            <label for="tag">Tag:</label>
                            <input type="text" class="form-control" name="tag" required placeholder="Enter tag name">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Add Tag</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Set Thesis Status Modal -->
    <div class="modal fade" id="setStatusModal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Set Thesis Status</h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form method="POST" action="{{ url_for('researcher.set_thesis_status') }}">
                    <div class="modal-body">
                        <input type="hidden" name="thesis_id" value="{{ thesis.id }}">
                        <div class="form-group">
                            <label for="status">New Status:</label>
                            <select class="form-control" name="status" required>
                                <option value="">Select Status</option>
                                <option value="in-progress">In Progress</option>
                                <option value="needs-revision">Needs Revision</option>
                                <option value="approved">Approved</option>
                                <option value="suspended">Suspended</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="notes">Status Notes (Optional):</label>
                            <textarea class="form-control" name="notes" rows="3" placeholder="Add any notes about this status change..."></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Set Status</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add New ToDo Modal -->
    <div class="modal fade" id="addTodoModal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New ToDo</h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form method="POST" action="{{ url_for('researcher.add_todo') }}">
                    <input type="hidden" name="thesis_id" value="{{ thesis.id }}">
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="title">ToDo Title:</label>
                            <input type="text" class="form-control" name="title" required>
                        </div>
                        <div class="form-group">
                            <label for="description">Description:</label>
                            <textarea class="form-control" name="description" rows="3"></textarea>
                        </div>
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                <label for="priority">Priority:</label>
                                <select class="form-control" name="priority">
                                    <option value="low">Low</option>
                                    <option value="medium" selected>Medium</option>
                                    <option value="high">High</option>
                                </select>
                            </div>
                            <div class="form-group col-md-6">
                                <label for="assigned_to_id">Assign To:</label>
                                <select class="form-control" name="assigned_to_id">
                                    {% if author %}
                                    <option value="{{ author.id }}">{{ author.name }} {{ author.surname }} (Student)</option>
                                    {% endif %}
                                    <option value="{{ current_user.id }}">{{ current_user.name }} {{ current_user.surname }} (Me)</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="due_date">Due Date (Optional):</label>
                            <input type="date" class="form-control" name="due_date">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Add ToDo</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Meeting Note Modal -->
    <div class="modal fade" id="addMeetingNoteModal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Meeting Note</h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form method="POST" action="{{ url_for('researcher.add_meeting_note') }}">
                    <input type="hidden" name="thesis_id" value="{{ thesis.id }}">
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="title">Meeting Title:</label>
                            <input type="text" class="form-control" name="title" required>
                        </div>
                        <div class="form-group">
                            <label for="content">Meeting Notes:</label>
                            <textarea class="form-control" name="content" rows="8" required placeholder="Meeting agenda, discussions, decisions, action items..."></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Meeting Note</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Meeting Note Modal -->
    <div class="modal fade" id="editMeetingNoteModal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Meeting Note</h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form method="POST" action="{{ url_for('researcher.edit_meeting_note') }}" id="editMeetingNoteForm">
                    <div class="modal-body">
                        <input type="hidden" name="note_id" id="editMeetingNoteId">
                        <div class="form-group">
                            <label for="title">Meeting Title:</label>
                            <input type="text" class="form-control" name="title" id="editMeetingNoteTitle" required>
                        </div>
                        <div class="form-group">
                            <label for="content">Meeting Notes:</label>
                            <textarea class="form-control" name="content" id="editMeetingNoteContent" rows="8" required></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Update Meeting Note</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add New Objective Modal -->
    <div class="modal fade" id="addObjectiveModal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Objective</h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form method="POST" action="{{ url_for('researcher.add_objective') }}">
                    <input type="hidden" name="thesis_id" value="{{ thesis.id }}">
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="title">Objective Title:</label>
                            <input type="text" class="form-control" name="title" required>
                        </div>
                        <div class="form-group">
                            <label for="description">Description:</label>
                            <textarea class="form-control" name="description" rows="4" required></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-success">Add Objective</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Objective Modal -->
    <div class="modal fade" id="editObjectiveModal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Objective</h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form method="POST" action="{{ url_for('researcher.edit_objective') }}" id="editObjectiveForm">
                    <div class="modal-body">
                        <input type="hidden" name="objective_id" id="editObjectiveId">
                        <div class="form-group">
                            <label for="title">Objective Title:</label>
                            <input type="text" class="form-control" name="title" id="editObjectiveTitle" required>
                        </div>
                        <div class="form-group">
                            <label for="description">Description:</label>
                            <textarea class="form-control" name="description" id="editObjectiveDescription" rows="4" required></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-success">Update Objective</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add New Hypothesis Modal -->
    <div class="modal fade" id="addHypothesisModal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Hypothesis</h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form method="POST" action="{{ url_for('researcher.add_hypothesis') }}">
                    <input type="hidden" name="thesis_id" value="{{ thesis.id }}">
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="title">Hypothesis Title:</label>
                            <input type="text" class="form-control" name="title" required>
                        </div>
                        <div class="form-group">
                            <label for="description">Hypothesis Description:</label>
                            <textarea class="form-control" name="description" rows="4" required></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-warning">Add Hypothesis</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Hypothesis Modal -->
    <div class="modal fade" id="editHypothesisModal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Hypothesis</h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form method="POST" action="{{ url_for('researcher.edit_hypothesis') }}" id="editHypothesisForm">
                    <div class="modal-body">
                        <input type="hidden" name="hypothesis_id" id="editHypothesisId">
                        <div class="form-group">
                            <label for="title">Hypothesis Title:</label>
                            <input type="text" class="form-control" name="title" id="editHypothesisTitle" required>
                        </div>
                        <div class="form-group">
                            <label for="description">Hypothesis Description:</label>
                            <textarea class="form-control" name="description" id="editHypothesisDescription" rows="4" required></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-warning">Update Hypothesis</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Thesis Modal -->
    <div class="modal fade" id="editThesisModal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Thesis</h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form method="POST" action="{{ url_for('researcher.update_thesis') }}">
                    <input type="hidden" name="thesis_id" value="{{ thesis.id }}">
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="title">Thesis Title:</label>
                            <input type="text" class="form-control" name="title" value="{{ thesis.title }}" required>
                        </div>
                        <div class="form-group">
                            <label for="description">Description:</label>
                            <textarea class="form-control" name="description" rows="4" required>{{ thesis.description }}</textarea>
                        </div>
                        <div class="form-group">
                            <label for="level">Level:</label>
                            <select class="form-control" name="level" required>
                                <option value="">Select Level</option>
                                <option value="bachelor" {% if thesis.level == 'bachelor' %}selected{% endif %}>Bachelor</option>
                                <option value="master" {% if thesis.level == 'master' %}selected{% endif %}>Master</option>
                                <option value="phd" {% if thesis.level == 'phd' %}selected{% endif %}>PhD</option>
                                <option value="other" {% if thesis.level == 'other' %}selected{% endif %}>Other</option>
                            </select>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Update Thesis</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded" href="#page-top">
        <i class="fas fa-angle-up"></i>
    </a>

    <!-- Bootstrap core JavaScript-->
    <script src="{{ url_for('static', filename='vendor/jquery/jquery.min.js') }}"></script>
    <script src="{{ url_for('static', filename='vendor/bootstrap/js/bootstrap.bundle.min.js') }}"></script>

    <!-- Core plugin JavaScript-->
    <script src="{{ url_for('static', filename='vendor/jquery-easing/jquery.easing.min.js') }}"></script>

    <!-- Custom scripts for all pages-->
    <script src="{{ url_for('static', filename='js/sb-admin-2.min.js') }}"></script>

    <script>
        function freezeThesis(thesisId) {
            if (confirm('Are you sure you want to freeze this thesis? Students will not be able to make changes.')) {
                var form = document.createElement('form');
                form.method = 'POST';
                form.action = '{{ url_for("researcher.freeze_thesis") }}';
                
                var input = document.createElement('input');
                input.type = 'hidden';
                input.name = 'thesis_id';
                input.value = thesisId;
                form.appendChild(input);
                
                document.body.appendChild(form);
                form.submit();
            }
        }
        
        function unfreezeThesis(thesisId) {
            if (confirm('Are you sure you want to unfreeze this thesis?')) {
                var form = document.createElement('form');
                form.method = 'POST';
                form.action = '{{ url_for("researcher.unfreeze_thesis") }}';
                
                var input = document.createElement('input');
                input.type = 'hidden';
                input.name = 'thesis_id';
                input.value = thesisId;
                form.appendChild(input);
                
                document.body.appendChild(form);
                form.submit();
            }
        }

        function editUpdate(updateId, title, content) {
            $('#edit_update_id').val(updateId);
            $('#edit_update_title').val(title);
            $('#edit_update_content').val(content);
            $('#editFeedbackModal').modal('show');
        }

        function commentOnUpdate(updateId) {
            $('#comment_update_id').val(updateId);
            $('#commentModal').modal('show');
        }

        function tagUpdate(updateId) {
            $('#tag_update_id').val(updateId);
            $('#tagModal').modal('show');
        }

        function editObjective(objectiveId, title, description) {
            $('#editObjectiveId').val(objectiveId);
            $('#editObjectiveTitle').val(title);
            $('#editObjectiveDescription').val(description);
            $('#editObjectiveModal').modal('show');
        }

        function editHypothesis(hypothesisId, title, description) {
            $('#editHypothesisId').val(hypothesisId);
            $('#editHypothesisTitle').val(title);
            $('#editHypothesisDescription').val(description);
            $('#editHypothesisModal').modal('show');
        }

        function editMeetingNote(noteId, title, content) {
            $('#editMeetingNoteId').val(noteId);
            $('#editMeetingNoteTitle').val(title);
            $('#editMeetingNoteContent').val(content);
            $('#editMeetingNoteModal').modal('show');
        }
    </script>

</body>

</html>